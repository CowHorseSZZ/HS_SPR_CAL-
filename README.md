# HS_SPR_CAL
Hearthstone Spectral Pillager Rogue Calculator
炉石鬼灵贼计算器 持续更新中

**写在最前面**：官方插件可以记牌，可以计算场攻，可以算酒馆战棋对战胜率。HDT插件还可以在酒馆战棋决赛时计算不同站位的胜率（假设对手阵容不变）。这个计算器可以计算鬼灵贼的斩杀方式。这些都是计算，没有区别。

**update[20220921]**

1. 修复了将黑刀识别为法术，从而可以被伺机待发减费的BUG。现在黑刀将视为新牌名“武器”。

2. 修复了将垂钓和行骗识别为法术，从而和老千互动并不符合预期的BUG。现在垂钓和行骗将视为新牌名“连法”。

3. 修复了在受到法术加费光环的影响时，算法仍然会试图优先打出假币（硬币）的BUG。现在应当能够正确工作。

4. 修复了在被癫狂公爵交换手牌的情况下，手牌读取可能发生错误的BUG。现在应当能够正确工作。

5. 修复了一些曾经作用于手牌的buff，被buff的卡牌已经离开手牌后，buff仍然会作用到当前手牌，导致手牌读取发生错误的BUG。现在应当能够正确工作。

**以下为新特性**

6. 现在将目标值设置为999时，读取将不会改变目标值。这适用于始终希望计算最高伤害的情形。

7. 现在摁Ctrl可以读取（并且原先摁Enter就可以计算）。

8. 现在小键盘的数字键应该有效了。

9. 现在读取后会清空答案框。

10. 现在会将要挟当作1费的背刺。

11. 现在可以读取到更多的光环buff与手牌buff了，包括蛛魔拆解者、尼鲁巴、淤泥水管工这些光环buff，以及前沿哨所、诈死这些手牌buff。并且现在会将诈死当作2费普通法术了。

（原先可以读取塞布、持枪、女塞、涂粉这些光环buff，以及黑刀、暗影步、幻觉药水、腾武这些手牌buff）

12. 现在读取到的手牌顺序和游戏中应该一致了。随从顺序应该也一致，但是是从左到右而不是登场顺序。因此如果在实战中，如果随从的登场顺序不是从左到右，可能会导致幻觉药水的回手顺序和预期的不一致。

13. 现在读取的速度应当会比之前快一些，但是可能会多占用一些内存。

14. **随从血量特性** 现在手牌中的随从具有血量（在UI的最下一行），而场上的随从具有当前血量和总血量（在UI的向下倒数第五行和向下倒数第四行）。内部实现的状态做出了这样的改变，这将：

和背刺的互动更合理。尽管如此还是有“背刺不杀死友方随从时将不显示背刺目标”特性以及可能的其他特性。
  
**支持齿刺（锯齿骨刺），但目前仅支持对己方随从使用齿刺**。
  
算法效率可能有所降低。
  
算法在一些极端情况下可能无法搜索到最优解（即使已经穷尽）。

**当前版本已知特性：**

必然还有一些buff未被识别从而读取错误。

无法识别被沉默的随从（认为其异能仍然生效）。

与敌方随从有关的老问题：允许对同一个随从用两个背刺，或者前文提到的不能对敌方随从使用骨刺。

界面还需要优化：调整大小，简洁模式，一键同时读取计算，计算下回合，手动掐断，“关于”等。以及存在即使没有在进行计算，内存消耗仍然较高的问题。

还未添加和牌库的交互，和冰箱的交互，等等。

<br/>
<br/>
<br/>

**update[20220907]**

支持的情况基本都在UI上体现了。

可以手动添加法术、随从、战吼的加费光环。可以自动读入部分（写进去的）的加费光环。可以自动读入四项临时减费光环（XX层数）。

修改了费用读取逻辑，改为从原始费用开始维护所有真实增益，防止（真实）费用读取受到各类光环的影响。

目前UI支持鼠标和键盘，鼠标为选中-修改模式，键盘简化部分鼠标操作，支持上下左右移动选中（仅限手牌区和站场区），0-9修改数字（选中后首次修改从零起，可依次输入多位但有上限），backspace清除数字，字母修改牌名（根据二字短名的首字母），delete清除牌名，enter计算。

目前UI已经能保存读取路径至dft.txt中。

小提示1：将目标设置为999可以试图计算最高伤害。可以提高时限。

小提示2：如果想提前计算下个回合的斩杀线，在增加水晶之后还要记得把已用牌数清空。

**已经整合成了多文件版本，请使用cmake以得到可执行文件**

buildw/有Windows的可执行版本HSSPRCAL.exe，结合fml.txt使用。不对该exe运行产生的任何后果负责，如不信任请自行cmake。
